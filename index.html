<!doctype html>

<html lang="en">
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=1024"/>
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<title>Gleam.js - Node.js/Browser re-usable Entities</title>

	<meta name="description" content=">Gleam.js - Node.js/Browser re-usable Entities presentation"/>
	<meta name="author" content="Nik Butenko"/>

	<link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet"/>

	<link href="css/impress-demo.css" rel="stylesheet"/>

	<link rel="shortcut icon" href="favicon.png"/>
	<link rel="apple-touch-icon" href="apple-touch-icon.png"/>

	<link rel="stylesheet" href="css/highlight/tomorrow-night-eighties.css">
</head>

<body class="impress-not-supported">


<div class="fallback-message">
	<p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
	<p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
</div>

<!--

    Now that's the core element used by impress.js.

    That's the wrapper for your presentation steps. In this element all the impress.js magic happens.
    It doesn't have to be a `<div>`. Only `id` is important here as that's how the script find it.

    You probably won't need it now, but there are some configuration options that can be set on this element.

    To change the duration of the transition between slides use `data-transition-duration="2000"` giving it
    a number of ms. It defaults to 1000 (1s).

    You can also control the perspective with `data-perspective="500"` giving it a number of pixels.
    It defaults to 1000. You can set it to 0 if you don't want any 3D effects.
    If you are willing to change this value make sure you understand how CSS perspective works:
    https://developer.mozilla.org/en/CSS/perspective

    But as I said, you won't need it for now, so don't worry - there are some simple but interesing things
    right around the corner of this tag ;)

-->

<div id="impress" data-transition-duration="500">

	<div id="title" class="step" data-x="1100" data-y="-1000" data-scale="1">
		<p class="try">Node.js/Browser re-usable Entities</p>

		<h1>Gleam.js</h1>
		<p>for consistency of interfaces and data&nbsp;validation</p>

		<div class="footnote">
			<p>Sydney, 19th September 2013</p>
			<p>Nik Butenko</p>
		</div>
	</div>

	<div id="crud" class="step slide same" data-x="0" data-y="0">
		<h2>Imagine your usual CRUD Insert</h2>
	</div>

	<div id="crud-1" class="step slide same" data-x="0" data-y="0">
		<h2>Imagine your usual CRUD Insert</h2>
		<ol>
			<li>Render form</li>
			<li>Listen to submit</li>
			<li><span class="highlight">Validate input</span> / <span class="highlight">Browser</span></li>
		</ol>
	</div>

	<div id="crud-2" class="step slide same" data-x="0" data-y="0">
		<h2>Imagine your usual CRUD Insert</h2>
		<ol>
			<li>Render form</li>
			<li>Listen to submit</li>
			<li><span class="highlight">Validate input</span> / <span class="highlight">Browser</span></li>
			<li>Send JSON to server</li>
			<li>Unserialize JSON</li>
			<li><span class="highlight">Validate input</span> / <span class="highlight">Server</span></li>
		</ol>
	</div>

	<div id="crud-3" class="step slide same" data-x="0" data-y="0">
		<h2>Imagine your usual CRUD Insert</h2>
		<ol>
			<li>Render form</li>
			<li>Listen to submit</li>
			<li><span class="highlight">Validate input</span> / <span class="highlight">Browser</span></li>
			<li>Send JSON to server</li>
			<li>Unserialize JSON</li>
			<li><span class="highlight">Validate input</span> / <span class="highlight">Server</span></li>
			<li><span class="highlight">Normalize object</span> / <span class="highlight">Server</span></li>
		</ol>
	</div>

	<div id="crud-4" class="step slide same" data-x="0" data-y="0">
		<h2>Imagine your usual CRUD Insert</h2>
		<ol>
			<li>Render form</li>
			<li>Listen to submit</li>
			<li><span class="highlight">Validate input</span> / <span class="highlight">Browser</span></li>
			<li>Send JSON to server</li>
			<li>Unserialize JSON</li>
			<li><span class="highlight">Validate input</span> / <span class="highlight">Server</span></li>
			<li><span class="highlight">Normalize object</span> / <span class="highlight">Server</span></li>
			<li>Save to DB</li>
			<li>???</li>
			<li class="highlight">PROFIT!</li>
		</ol>
	</div>

	<div id="form" class="step slide same" data-x="1100" data-y="0">
		<h2>Form to add chat</h2>
		<p>&nbsp;</p>
		<pre><code class="html">
<form role="form" action="/chat/add" method="POST">

	<div class="form-group">
		<label for="id">Link</label>
		<input type="text" class="form-control" name="id" id="id">
	</div>

	<div class="form-group">
		<label for="name">Title</label>
		<input type="text" class="form-control" name="name" id="name">
	</div>

	<button type="submit" class="btn btn-default">Submit</button>

</form>
		</code></pre>
	</div>

	<div id="form-1" class="step slide same" data-x="1100" data-y="0">
		<h2>Form to add chat</h2>
		<p>With HTML5 validation</p>
		<pre><code class="html">

<form role="form" action="/chat/add" method="POST">

	<div class="form-group">
		<label for="id">Link</label>
		<input required pattern="[a-z_\-0-9]+" type="text" class="form-control" name="id" id="id">
	</div>

	<div class="form-group">
		<label for="name">Title</label>
		<input required type="text" class="form-control" name="name" id="name">
	</div>

	<button type="submit" class="btn btn-default">Submit</button>

</form>

		</code></pre>
	</div>

	<div id="validate" class="step slide same" data-x="2200" data-y="0">
		<h2>Validate in Browser</h2>
		<pre><code class="js">
function isValid($form) {
	var id = $form.find('[name=id]').val(),
			name = $form.find('[name=name]').val();
	return id.length && id.match('/^[a-z_-0-9]+/$') && name.length;

}
function onSubmit() {
	var $form = $(this);
	if (isValid($form)) {
		sendToServer($form);
	}
}
		</code></pre>
	</div>


	<div id="validate-1" class="step slide same" data-x="2200" data-y="0">
		<h2>Validate on Server</h2>
		<pre><code class="js">

function isValid(data) {
	return data.id 
			&& data.id.length 
			&& data.id.match('/^[a-z_-0-9]+/$') 
			&& data.name 
			&& data.name.length;

}
function chatAdd(req, res) {
	if (isValid(req.body)) {
		return saveToDb(
			normalize(req.body), 
			renderResponse(res)
		);
	}

	return renderResponse(res)({
		error: true, 
		message: "OMG!"
	});
}

		</code></pre>
	</div>


	<div id="problem" class="step slide same" data-x="1100" data-y="1400" data-scale="1">
		<h2>Problem?</h2>
		<img src="doc/problem.jpg" style="display: block; max-width: 90%; max-height: 80%; margin: 0 auto;" alt=""/>
		<p style="position: absolute; bottom: 1em; right: 2em; font-size: 10px; color: #888; text-align: right;">Pic by The Mary Sue www.themarysue.com</p>
	</div>

	<div id="problem-1" class="step slide same" data-x="1100" data-y="1400" data-scale="1">
		<h2>Problem?</h2>
		<ol>
			<li class="highlight">Write your validation 2 times (Server JS, Client JS)</li>
		</ol>
	</div>

	<div id="problem-2" class="step slide same" data-x="1100" data-y="1400" data-scale="1">
		<h2>Problem?</h2>
		<ol>
			<li>Write your validation 2 times (Server JS, Client JS)</li>
			<li class="highlight">Optionally one more time (HTML5)</li>
		</ol>
	</div>

	<div id="problem-3" class="step slide same" data-x="1100" data-y="1400" data-scale="1">
		<h2>Problem?</h2>
		<ol>
			<li>Write your validation 2 times (Server JS, Client JS)</li>
			<li>Optionally one more time (HTML5)</li>
			<li class="highlight">Check if you actually have necessary fields</li>
		</ol>
	</div>

	<div id="problem-4" class="step slide same" data-x="1100" data-y="1400" data-scale="1">
		<h2>Problem?</h2>
		<ol>
			<li>Write your validation 2 times (Server JS, Client JS)</li>
			<li>Optionally one more time (HTML5)</li>
			<li>Check if you actually have necessary fields</li>
			<li class="highlight">Normalize your objects before save to have consistency</li>
		</ol>
	</div>

	<div id="problem1" class="step slide same" data-x="2200" data-y="1400" data-scale="1">
		<h2>Then later:</h2>
		<ol>
			<li class="highlight">Get data from db</li>
		</ol>
	</div>

	<div id="problem1-1" class="step slide same" data-x="2200" data-y="1400" data-scale="1">
		<h2>Then later:</h2>
		<ol>
			<li>Get data from db</li>
			<li class="highlight">Make sure object has all necessary fields</li>
		</ol>
	</div>

	<div id="problem1-2" class="step slide same" data-x="2200" data-y="1400" data-scale="1">
		<h2>Then later:</h2>
		<ol>
			<li>Get data from db</li>
			<li>Make sure object has all necessary fields</li>
			<li class="highlight">Send to client</li>
		</ol>
	</div>

	<div id="problem1-3" class="step slide same" data-x="2200" data-y="1400" data-scale="1">
		<h2>Then later:</h2>
		<ol>
			<li>Get data from db</li>
			<li>Make sure object has all necessary fields</li>
			<li>Send to client</li>
			<li class="highlight">Check on client if you get correct objects from server</li>
		</ol>
	</div>

	<div id="problem1-4" class="step slide same" data-x="2200" data-y="1400" data-scale="1">
		<h2>Then later:</h2>
		<ol>
			<li>Get data from db</li>
			<li>Make sure object has all necessary fields</li>
			<li>Send to client</li>
			<li>Check on client if you get correct objects from server</li>
			<li class="highlight">Check if you actually have all necessary fields</li>
		</ol>
	</div>

	<div id="problem1-5" class="step slide same" data-x="2200" data-y="1400" data-scale="1">
		<h2>Then later:</h2>
		<ol>
			<li>Get data from db</li>
			<li>Make sure object has all necessary fields</li>
			<li>Send to client</li>
			<li>Check on client if you get correct objects from server</li>
			<li>Check if you actually have all necessary fields</li>
			<li class="highlight">And at last - SHOW THEM!</li>
		</ol>
		<p style="margin-top: 70px; font-size: 0.7em; color: #888; text-align: right;">Yes, yes, I am paranoic about data consistency</p>
	</div>


	<div id="gleam" class="step slide same" data-x="2200" data-y="2800" data-scale="2">
		<h2>Gleam to the rescue!</h2>
		<img src="doc/to-the-rescue.jpg" style="display: block; max-width: 90%; max-height: 80%; margin: 0 auto;" alt=""/>
		<p style="position: absolute; bottom: 1em; right: 2em; font-size: 10px; color: #888; text-align: right;">Pic by The Mary Sue www.themarysue.com</p>
	</div>

	
	<div id="gleam-1" class="step slide same" data-x="2200" data-y="2800" data-scale="2">
		<h2>Add to your ExpressJS project</h2>
		<pre><code class="js">
// Install Gleam first "npm install nkbt/gleam" 
//	or add as dependency - "gleam": "nkbt/gleam"
	
// ./app.js

// Require and configure Gleam
var gleam = require('gleam');
gleam.setRoot(path.join(__dirname, 'gleams'));

// [...] Do some ExpressJS configuration
			
// Add entity-serving middle-ware
// somewhere after static middleware
app.use(express.static(path.join(__dirname, 'public')));
app.use('/js/entity', gleam.serveEntity);
		</code></pre>
	</div>
	
	<div id="gleam-2" class="step slide same" data-x="2200" data-y="2800" data-scale="2">
		<h2>Write your Entity</h2>
		<pre><code class="js">
// ./gleams/chat.js
'use strict';

var ChatEntity = {
	id: null,
	name: null,
	createdOn: null
};

// You need to export "Entity"
exports.Entity = ChatEntity;
		</code></pre>
	</div>
	
	<div id="gleam-2-1" class="step slide same" data-x="2200" data-y="2800" data-scale="2">
		<h2>Add validation</h2>
		<pre><code class="js">
// ./gleams/chat.js

var ChatEntity = {

	//...

	validateId: function (value) {
		return !_.isEmpty(value) 
			&& _.isEqual(value, value.replace(/[^a-z_\-0-9]+/, ''));
	},

	validateName: function (value) {
		return !_.isEmpty(value);
	}

};
		</code></pre>
	</div>
	
	<div id="gleam-2-2" class="step slide same" data-x="2200" data-y="2800" data-scale="2">
		<h2>Add getters/setters</h2>
		<pre><code class="js">
// ./gleams/chat.js

var ChatEntity = {

	//...

	getCreatedOn: function () {
		if (!this.createdOn) {
			var now = new Date();
			return now.getTime();
		}
		return this.createdOn;
	}

};
		</code></pre>
	</div>
	
	<div id="gleam-3" class="step slide same" data-x="2200" data-y="2800" data-scale="2">
		<h2>Run your app and try:</h2>
		<ol>
			<li class="highlight">/js/entity/chat.js</li>
			<li>/js/entity/from-json.js</li>
			<li>/js/entity/abstract.js</li>
			<li>/js/entity/inherit.js</li>
		</ol>
	</div>
	
	<div id="gleam-4" class="step slide same" data-x="2200" data-y="2800" data-scale="2">
		<h2>Submit form</h2>
		
		<pre><code class="js">
"use strict";

define(['entity/chat'], function (ChatEntity) {

	var chatEntity = new ChatEntity();
	try {
		chatEntity.set(getValues($form));
	} catch (error) {
		return alert(error.message);
	}
	// Submit to server

});
		</code></pre>
	</div>
	
	<div id="gleam-5" class="step slide same" data-x="2200" data-y="2800" data-scale="2">
		<h2>Restore JSON</h2>
		
		<pre><code class="js">
"use strict";

define(['entity/from-json'], function (fromJson) {

	$.ajax({
		url: '', data: {/* some data */},
		dataType: 'text', // We need text!
		success: function (jsonString) {
			return fromJson(jsonString, function(error, entity) {
				console.log(entity);
			});
		}
	});

});
		</code></pre>
	</div>
	
	
	<div id="gleam-6" class="step slide same" data-x="2200" data-y="2800" data-scale="2">
		<h2>Save on server</h2>
		
		<pre><code class="js">
"use strict";

var gleam = require('gleam');

function addChat(req, res) {
	try {
		var chatEntity = gleam.entity('chat', req.body);
	} catch (error) {
		// handle
	}
	// save chatEntity in DB
	db.save(chatEntity.get());
};
		</code></pre>
	</div>	
	
	<div id="gleam-7" class="step slide same" data-x="2200" data-y="2800" data-scale="2">
		<h2>Get on server</h2>
		
		<pre><code class="js">
"use strict";

var gleam = require('gleam');

function getChat(req, res) {
	db.get(req.param.id, function(json) {
		try {
			var chatEntity = gleam.fromJson(json);
		} catch (error) {
			// handle
		}
		res.json(chatEntity.get());
	})
};
		</code></pre>
	</div>

	
	<div id="summary" class="step slide same" data-x="2200" data-y="2800" data-scale="2">
		<h2>Summary</h2>
		
		<ol>
			<li>Write your entity once</li>
			<li>Write your validation, type casting, getters once</li>
			<li>Use it on a server</li>
			<li>Re-use it in your browser</li>
			<li>Always be sure your objects have all properties</li>
		</ol>
		
	</div>


	<div id="links" class="step slide" data-x="2200" data-y="5600" data-scale="4">
		<b>Thanks!</b>
		<p><a href="https://github.com/nkbt/gleam-demo" target="_blank">https:// github.com / <strong>nkbt</strong> / gleam-demo</a></p>
		<p><a href="http://butenko.me" target="_blank">http:// <strong>butenko.me</strong></a></p>
	</div>


</div>

<ul id="nav">
	<li><a href="#title">Title</a></li>
	<li><a href="#crud">Process</a></li>
	<li><a href="#form">Form</a></li>
	<li><a href="#validate">Validate</a></li>
	<li><a href="#problem">Problem?</a></li>
	<li><a href="#gleam">Gleam</a></li>
	<li><a href="#summary">Summary</a></li>
	<li><a href="#links">Thanks</a></li>
</ul>


<script type="text/javascript">
	Array.prototype.slice.apply(document.querySelectorAll('pre code')).forEach(function(element) {
		element.innerHTML = element.innerHTML.trim();
	})
	Array.prototype.slice.apply(document.querySelectorAll('pre code.html')).forEach(function(element) {
		element.innerHTML = element.innerHTML.trim()
			.replace(/</g, '&lt;')
			.replace(/>/g, '&gt;')
			.replace(/ /g, '&nbsp;')
			.replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;')					
	})
</script>
<script src="js/impress.js"></script>
<script>impress().init();</script>
<script src="js/highlight.js"></script>
<script>
	hljs.tabReplace = '    '
	hljs.initHighlightingOnLoad();
</script>
</body>
</html>